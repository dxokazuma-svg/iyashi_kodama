<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç™’ã—å¾…å¤¢ çµ¦æ–™è¨ˆç®—ï¼ˆç‰ã¡ã‚ƒã‚“ï¼‰</title>

<style>
:root{
  --pink:#F6A5C0;
  --pink-soft:#FDE7EF;
  --pink-strong:#E85A8A;
  --border:#F6A5C0;
  --muted:#666;
}
body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP",sans-serif;background:#fff;margin:0;}
header{background:var(--pink);color:#fff;text-align:center;padding:14px;font-weight:800;}
.container{padding:14px;max-width:560px;margin:0 auto;}
.card{background:var(--pink-soft);border-radius:14px;padding:14px;margin-bottom:12px;}
h3{margin:0 0 10px;font-size:16px;}
select{width:100%;padding:12px;font-size:18px;border-radius:12px;border:2px solid var(--border);font-weight:800;}
.btn-row{display:flex;flex-wrap:wrap;gap:10px;}
.btn{flex:1 1 30%;padding:14px 10px;border-radius:12px;border:2px solid var(--border);background:#fff;color:var(--pink);font-weight:800;font-size:14px;}
.btn.active{background:var(--pink);color:#fff;}
.result{text-align:center;}
.label{color:var(--muted);font-size:14px;}
.value{font-size:34px;color:var(--pink-strong);font-weight:900;}
.value.small{font-size:30px;}
.primary{width:100%;border:none;border-radius:14px;padding:14px;font-size:17px;font-weight:900;background:var(--pink);color:#fff;}
.list{background:#fff;border-radius:14px;padding:10px;border:2px solid #f3b7cc;}
.row{display:grid;grid-template-columns:1.2fr 1fr 1fr 1fr auto;gap:6px;padding:6px;font-size:13px;border-bottom:1px solid #eee;}
.row.head{font-weight:900;color:#666;}
.cell.back{color:var(--pink-strong);font-weight:900;}
.sticky{background:var(--pink-soft);border:2px solid #f3b7cc;border-radius:14px;padding:10px;margin-top:10px;font-weight:900;}
.note{color:#666;font-size:12px;margin-top:6px;}
</style>
</head>

<body>
<header>
ç™’ã—å¾…å¤¢<br>
<small>çµ¦æ–™è¨ˆç®—ï¼ˆå…ç‰ï¼‰</small>
</header>

<div class="container">

<!-- ãŠå®¢ã•ã‚“é‡‘é¡ -->
<div class="card">
  <h3>ãŠå®¢ã•ã‚“é‡‘é¡</h3>
  <select id="price">
    <option value="0">é¸æŠã—ã¦ãã ã•ã„</option>
  </select>
  <div class="note">â€» ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã¯0å††æ‰±ã„</div>
</div>

<!-- ã‚³ãƒ¼ã‚¹ï¼ˆå¿…ãš1ã¤ï¼‰ -->
<div class="card">
  <h3>ã‚³ãƒ¼ã‚¹ï¼ˆå¿…ãš1ã¤é¸æŠï¼‰</h3>
  <div class="btn-row">
    <button class="btn course-btn" data-course="90">90åˆ†</button>
    <button class="btn course-btn" data-course="120">120åˆ†</button>
    <button class="btn course-btn" data-course="150">150åˆ†</button>
  </div>
</div>

<!-- æŒ‡åï¼ˆ3æŠï¼‰ -->
<div class="card">
  <h3>æŒ‡åï¼ˆã©ã‚Œã‹1ã¤ï¼‰</h3>
  <div class="btn-row">
    <button class="btn nom-btn" data-nom="free">ãƒ•ãƒªãƒ¼</button>
    <button class="btn nom-btn" data-nom="net">ãƒãƒƒãƒˆæŒ‡å</button>
    <button class="btn nom-btn" data-nom="hon">æœ¬æŒ‡å</button>
  </div>
</div>

<!-- å»¶é•·ï¼ˆ5æŠï¼‰ -->
<div class="card">
  <h3>å»¶é•·ï¼ˆã©ã‚Œã‹1ã¤ï¼‰</h3>
  <div class="btn-row">
    <button class="btn ext-btn" data-ext="none">ãªã—</button>
    <button class="btn ext-btn" data-ext="30">+30åˆ†</button>
    <button class="btn ext-btn" data-ext="60">+60åˆ†</button>
    <button class="btn ext-btn" data-ext="90">+90åˆ†</button>
    <button class="btn ext-btn" data-ext="120">+120åˆ†</button>
  </div>
</div>

<!-- çµæœ -->
<div class="card result">
  <div class="label">ä»Šå›ã®ãƒãƒƒã‚¯åˆè¨ˆ</div>
  <div class="value" id="back">Â¥ 0</div>
  <div style="height:10px;"></div>
  <div class="label">ä»Šå›ã®åº—è½ã¡</div>
  <div class="value small" id="shop">Â¥ 0</div>
</div>

<button class="primary" id="addBtn">ã“ã®å†…å®¹ã‚’è¿½åŠ </button>

<!-- å±¥æ­´ -->
<div class="card">
  <h3>ä»Šæ—¥ã®å±¥æ­´</h3>
  <div class="list" id="listArea"></div>
  <div class="sticky" id="totalArea"></div>
</div>

</div>

<script>
// ===== ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ï¼ˆã‚³ãƒ¼ã‚¹ï¼‰=====
function courseBack(course){
  if(course === "90") return 7800;
  if(course === "120") return 9600;
  if(course === "150") return 12000;
  return 0;
}

// ===== ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ï¼ˆæŒ‡åï¼‰=====
function nominateBack(n){
  if(n === "free") return 0;
  if(n === "net") return 0;
  if(n === "hon") return 1000;
  return 0;
}

// ===== ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ï¼ˆå»¶é•·ï¼‰=====
function extBack(e){
  if(e === "30") return 2500;
  if(e === "60") return 5000;
  if(e === "90") return 7500;
  if(e === "120") return 10000;
  return 0; // none
}

// ===== é‡‘é¡ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ç”Ÿæˆ =====
const priceSelect = document.getElementById("price");

// ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆï¼ˆ0å††ï¼‰ã ã‘æ®‹ã™
const zero = document.createElement("option");
zero.value = 0;
zero.textContent = "ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆï¼ˆ0å††ï¼‰";
priceSelect.appendChild(zero);

// é€šå¸¸åˆ† 12000ã€œ100000ï¼ˆ1000å††åˆ»ã¿ï¼‰
for(let p = 12000; p <= 100000; p += 1000){
  const o = document.createElement("option");
  o.value = p;
  o.textContent = p;
  priceSelect.appendChild(o);
}

// ===== çŠ¶æ…‹ =====
let selectedCourse = "";     // "90" | "120" | "150"
let selectedNom = "free";    // "free" | "net" | "hon"
let selectedExt = "none";    // "none" | "30" | "60" | "90" | "120"

// åˆæœŸï¼šãƒ•ãƒªãƒ¼ï¼†å»¶é•·ãªã—ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
function setNom(n){
  selectedNom = n;
  document.querySelectorAll(".nom-btn").forEach(b=>{
    b.classList.toggle("active", b.dataset.nom === n);
  });
  calculate();
}
function setExt(e){
  selectedExt = e;
  document.querySelectorAll(".ext-btn").forEach(b=>{
    b.classList.toggle("active", b.dataset.ext === e);
  });
  calculate();
}

// ã‚³ãƒ¼ã‚¹ï¼ˆå˜ä¸€ï¼‰
document.querySelectorAll(".course-btn").forEach(btn=>{
  btn.addEventListener("click", function(){
    selectedCourse = this.dataset.course;
    document.querySelectorAll(".course-btn").forEach(b=>b.classList.remove("active"));
    this.classList.add("active");
    calculate();
  });
});

// æŒ‡åï¼ˆ3æŠï¼‰
document.querySelectorAll(".nom-btn").forEach(btn=>{
  btn.addEventListener("click", function(){
    setNom(this.dataset.nom);
  });
});

// å»¶é•·ï¼ˆ5æŠï¼‰
document.querySelectorAll(".ext-btn").forEach(btn=>{
  btn.addEventListener("click", function(){
    setExt(this.dataset.ext);
  });
});

// åˆæœŸé¸æŠã‚’åæ˜ 
setNom("free");
setExt("none");

// é‡‘é¡å¤‰æ›´
priceSelect.addEventListener("change", calculate);

// è¨ˆç®—
function calculate(){
  const price = Number(priceSelect.value || 0);
  const back = courseBack(selectedCourse) + nominateBack(selectedNom) + extBack(selectedExt);
  const shop = price - back;
  document.getElementById("back").textContent = `Â¥ ${back.toLocaleString()}`;
  document.getElementById("shop").textContent = `Â¥ ${shop.toLocaleString()}`;
}

// ===== localStorageï¼ˆæ–°ã‚­ãƒ¼ï¼‰=====
function load(){
  const raw = localStorage.getItem("iyashimayu_ver_nomext_today");
  return raw ? JSON.parse(raw) : [];
}
function save(r){
  localStorage.setItem("iyashimayu_ver_nomext_today", JSON.stringify(r));
}

// è¡¨ç¤ºç”¨ãƒ©ãƒ™ãƒ«
function courseLabel(c){ return c ? `${c}åˆ†` : "æœªé¸æŠ"; }
function nomLabel(n){
  if(n==="net") return "ãƒãƒƒãƒˆæŒ‡å";
  if(n==="hon") return "æœ¬æŒ‡å";
  return "ãƒ•ãƒªãƒ¼";
}
function extLabel(e){
  if(e==="30") return "+30";
  if(e==="60") return "+60";
  if(e==="90") return "+90";
  if(e==="120") return "+120";
  return "å»¶é•·ãªã—";
}

// è¿½åŠ 
document.getElementById("addBtn").addEventListener("click", ()=>{
  if(!selectedCourse){
    alert("ã‚³ãƒ¼ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„");
    return;
  }
  const price = Number(priceSelect.value || 0);
  const back = courseBack(selectedCourse) + nominateBack(selectedNom) + extBack(selectedExt);
  const shop = price - back;

  const rec = { course:selectedCourse, nom:selectedNom, ext:selectedExt, price, back, shop };
  const data = load();
  data.push(rec);
  save(data);
  render();
});

// è¡¨ç¤º
function render(){
  const list = document.getElementById("listArea");
  const total = document.getElementById("totalArea");
  const data = load();

  if(data.length === 0){
    list.innerHTML = "<div style='text-align:center;color:#666;'>å±¥æ­´ãªã—</div>";
  }else{
    let html = `<div class="row head">
      <div>å†…å®¹</div><div>é‡‘é¡</div><div>ãƒãƒƒã‚¯</div><div>åº—è½ã¡</div><div></div>
    </div>`;
    data.forEach((r,i)=>{
      const content = `${courseLabel(r.course)} / ${nomLabel(r.nom)} / ${extLabel(r.ext)}`;
      html += `<div class="row">
        <div>${content}</div>
        <div>${r.price}</div>
        <div class="cell.back">${r.back}</div>
        <div>${r.shop}</div>
        <button onclick="del(${i})">ğŸ—‘</button>
      </div>`;
    });
    list.innerHTML = html;
  }

  const count = data.length;
  const sumBack = data.reduce((s,r)=>s+r.back,0);
  const sumShop = data.reduce((s,r)=>s+r.shop,0);

  total.innerHTML = `
    æœ¬æ•°ï¼š${count} æœ¬<br>
    ãƒãƒƒã‚¯åˆè¨ˆï¼šÂ¥ ${sumBack.toLocaleString()}<br>
    åº—è½ã¡åˆè¨ˆï¼šÂ¥ ${sumShop.toLocaleString()}
  `;
}

function del(i){
  const d = load();
  d.splice(i,1);
  save(d);
  render();
}

render();
calculate();
</script>

</body>
</html>
